#!/bin/bash

WINDOWID=`xdotool getactivewindow` 
WINDOWNAME=`xdotool getwindowname $WINDOWID`
WINDOWPID=`xdotool getwindowpid $WINDOWID`
WINDOWBIN=`readlink /proc/$WINDOWPID/exe`
IDLETIMEMS=`xprintidle`
IDLETIME=`expr $IDLETIMEMS / 1000`
WINDOWCWD=`readlink /proc/$WINDOWPID/cwd`

cat << EOF | http POST http://127.0.0.1:9137/task/state/ 2>&1 > /dev/null
{
	"exec": "$WINDOWBIN",
	"name": "$WINDOWNAME",
	"idle": "$IDLETIMEMS",
	"cwd": "$WINDOWCWD",
	"pid": "$WINDOWPID"
}
EOF

if [ "$IDLETIME" -gt `expr 5 '*' 60` ]; then
	timez stop $IDLETIME 2>&1 > /dev/null
fi

#echo "id="$WINDOWID "name="$WINDOWNAME "pid="$WINDOWPID
